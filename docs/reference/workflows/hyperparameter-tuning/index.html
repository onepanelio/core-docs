<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.62">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-106005416-5","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="The open and extensible IDE for computer vision" href="/opensearch.xml">
<script src="/js/gtm.js"></script><title data-react-helmet="true">Hyperparameter tuning | The open and extensible IDE for computer vision</title><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Hyperparameter tuning | The open and extensible IDE for computer vision"><meta data-react-helmet="true" name="description" content="Onepanel - Hyperparameter tuning"><meta data-react-helmet="true" property="og:description" content="Onepanel - Hyperparameter tuning"><meta data-react-helmet="true" property="og:url" content="https://docs.onepanel.ai/docs/reference/workflows/hyperparameter-tuning"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://docs.onepanel.ai/docs/reference/workflows/hyperparameter-tuning"><link rel="stylesheet" href="/styles.3a41faa6.css">
<link rel="preload" href="/styles.7bfb6080.js" as="script">
<link rel="preload" href="/runtime~main.84f271fb.js" as="script">
<link rel="preload" href="/main.e056a727.js" as="script">
<link rel="preload" href="/1.b53d8e00.js" as="script">
<link rel="preload" href="/2.7abf20c6.js" as="script">
<link rel="preload" href="/58.ffb2e96b.js" as="script">
<link rel="preload" href="/61.9849afbd.js" as="script">
<link rel="preload" href="/935f2afb.15dd73aa.js" as="script">
<link rel="preload" href="/17896441.2bcb897b.js" as="script">
<link rel="preload" href="/917b0442.c82b3e37.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon.svg" alt="Onepanel logo"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/docs/getting-started/quickstart">Getting Started</a><a class="navbar__item navbar__link" href="/docs/reference/overview">User Guide</a><a class="navbar__item navbar__link" href="/docs/deployment/overview">Operator Manual</a><a href="https://github.com/onepanelio/core/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Releases</a><a href="https://github.com/onepanelio/core/milestones?direction=asc&amp;sort=due_date&amp;state=open" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Roadmap</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/onepanelio/onepanel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-github-link">GitHub</a><a href="https://join.slack.com/t/onepanel-ce/shared_invite/zt-eyjnwec0-nLaHhjif9Y~gA05KuX6AUg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-slack-link">Slack</a><a href="https://twitter.com/onepanelai" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-twitter-link">Twitter</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon.svg" alt="Onepanel logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/quickstart">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/reference/overview">User Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/deployment/overview">Operator Manual</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/core/releases" target="_blank" rel="noopener noreferrer" class="menu__link">Releases</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/core/milestones?direction=asc&amp;sort=due_date&amp;state=open" target="_blank" rel="noopener noreferrer" class="menu__link">Roadmap</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/onepanel" target="_blank" rel="noopener noreferrer" class="menu__link header-icon-link header-github-link">GitHub</a></li><li class="menu__list-item"><a href="https://join.slack.com/t/onepanel-ce/shared_invite/zt-eyjnwec0-nLaHhjif9Y~gA05KuX6AUg" target="_blank" rel="noopener noreferrer" class="menu__link header-icon-link header-slack-link">Slack</a></li><li class="menu__list-item"><a href="https://twitter.com/onepanelai" target="_blank" rel="noopener noreferrer" class="menu__link header-icon-link header-twitter-link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/reference/overview">User guide</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Workspaces</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/launching">Launching a Workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/pause-and-resume">Pause and resume</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/upgrade">Switching node pool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/delete">Terminating a Workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/templates">Workspace Templates</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Workflows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/execute">Executing a Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/templates">Templates and parameters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/artifacts">Working with artifacts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/create">Creating a Workflow Template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/metrics">Persisting training metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/tensorboard">Accessing TensorBoard</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/reference/workflows/hyperparameter-tuning">Hyperparameter tuning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/troubleshooting">Troubleshooting Workflows</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Built-in and custom Workflows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/training">Model training</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/data-augmentation">Data augmentation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">CVAT Workspace</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cvat/quickstart">Getting started with image and video annotation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cvat/built-in-models">Training with built-in models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cvat/automatic-annotation">Using trained models for automatic annotation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cvat/custom-models">Adding custom training Workflows</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">JupyterLab Workspace</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/overview">JupyterLab overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/git">Using Git and browsing GitHub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/tensorboard">Using TensorBoard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/debugging">Using the built-in debugger</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/language-server">Auto completion and language features</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">SDKs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/sdks/python">Python SDK</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_1Lrw">Hyperparameter tuning</h1></header><div class="markdown"><p>Onepanel supports hyperparameter tuning for your TensorFlow and PyTorch models by fully integrating with <a href="https://github.com/microsoft/nni" target="_blank" rel="noopener noreferrer">NNI</a> and its <a href="https://nni.readthedocs.io/en/stable/Tuner/BuiltinTuner.html" target="_blank" rel="noopener noreferrer">built-in tuners</a>.</p><p>To understand how to add hyperparameter tuning into Onepanel Workflows, we&#x27;ll walk through the starter template under <strong>Workflows</strong> &gt; <strong>Workflow Templates</strong> &gt; <strong>Create Template</strong> &gt; <strong>Hyperparameter tuning</strong>.</p><p>There are 3 steps for integrating hyperparameter tuning into any training Workflow:</p><ol><li>Model training code - Make minor updates to grab hyperparameters from NNI and report accuracies back to NNI.</li><li>Workflow Template - Minor changes to the <strong>Hyperparameter tuning</strong> starter template to point to your code repository and paths.</li><li>Configuration - This is a field in the Workflow Template and it is where you indicate the type of tuner (e.g. TPE), the search space for hyperparameters and their corresponding ranges, path to your model training code, whether to use GPUs, etc.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="setting-up-your-workflow-template"></a>Setting up your Workflow Template<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-up-your-workflow-template" title="Direct link to heading">#</a></h2><ol><li><p>First, make changes to your training code to grab the parameters from NNI and report results back to NNI. Highlighted below are all the changes we had to make to <a href="https://github.com/onepanelio/templates/tree/v0.18.0/workflows/hyperparameter-tuning/mnist/main.py" target="_blank" rel="noopener noreferrer">MNIST example code</a> which is used in the <strong>Hyperparameter tuning</strong> starter template to support hyperparameter tuning. The <code>...</code> indicate code that was removed for brevity.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-python codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> nni</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Callback class for reporting intermediate accuracy metrics.</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ReportIntermediates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">on_epoch_end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> logs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">&quot;&quot;&quot;Reports intermediate accuracy to NNI framework&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        nni</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">report_intermediate_result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">logs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;val_accuracy&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    model </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Sequential</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">compile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        x_train</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        y_train</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        batch_size</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;batch_size&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        epochs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;epochs&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Add callback class for intermediate accuracy reporting</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">        callbacks</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ReportIntermediates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tensorboard</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        validation_data</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># send final accuracy to NNI tuner and web UI</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    nni</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">report_final_result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">accuracy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    params </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;dropout_rate&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;conv_size&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;hidden_size&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;batch_size&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;learning_rate&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1e</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;epochs&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># fetch hyper-parameters from NNI tuner</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    tuned_params </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> nni</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get_next_parameter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tuned_params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    _logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Hyperparameters: %s&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">parser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">parse_args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div></li><li><p>Go to <strong>Workflows</strong> &gt; <strong>Workflow Templates</strong> &gt; <strong>Create Template</strong> and select <strong>Hyperparameter tuning</strong>.</p></li><li><p>Update the Workflow Template to use your repository and update the paths in <code>/mnt/src</code> to match your repository&#x27;s directory structure. The <code>...</code> indicate sections that were removed for brevity.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">entrypoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Path to your training/model architecture code repository</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Change this value and revision value to your code repository and branch respectively</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/onepanelio/templates</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Revision is the branch or tag that you want to use</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># You can change this to any tag or branch name in your repository</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> revision</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v0.18.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">templates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">tasks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hyperparameter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">tuning</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hyperparameter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">tuning</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hyperparameter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">tuning</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Clone the above repository into `/mnt/data/src` - see https://docs.onepanel.ai/docs/reference/workflows/artifacts#git for private repositories</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">git</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">repo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.source}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">revision</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.revision}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/data/src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Path where config.yaml will be generated or already exists</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Update the path below so that config.yaml is written to the same directory as your main.py file</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Note that your source code is cloned to /mnt/data/src</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/data/src/&lt;path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">to</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">training</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">directory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">/config.yaml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">raw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.config}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> onepanel/dl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">0.20.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Update the path below to point to your code and config.yaml path as described above</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Note that you can &quot;pip install&quot; additional tools here if necessary</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        cd /mnt/data/src/&lt;path-to-training-code-directory&gt;/ &amp;&amp; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        python -u /opt/onepanel/nni/start.py --config config.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span></div></div></div></div></div></li><li><p>Update the Workflow Template title and click <strong>Save</strong>.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="understanding-the-configurations"></a>Understanding the configurations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#understanding-the-configurations" title="Direct link to heading">#</a></h2><p>When executing your new hyperparameter tuning Workflow Template, you will most likely need to adjust the <code>Configuration</code> parameter to indicate the type of tuner (e.g. TPE), update the search space for hyperparameters and their corresponding ranges, set the path to your model training code and set the number of GPUs.</p><p>Here is a description of each of the fields in the <code>Configuration</code> parameter:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">experimentName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> MNIST TF v2.x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">maxExperimentDuration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 1h</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">maxTrialNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">trainingService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">platform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> local</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">useActiveGpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">True</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">tuner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> TPE                  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># choices: TPE, Random, Anneal, Evolution, BatchTuner, MetisTuner, GPTuner</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">classArgs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">optimize_mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> maximize  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># choices: maximize, minimize</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">trialConcurrency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">trialGpuNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># update number to number of GPUs if GPU is present</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">trialCommand</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> python main.py </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">output /mnt/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Search space configuration</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Change according to your hyperparameters and ranges</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">searchSpace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">dropout_rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> uniform</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0.9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">conv_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> choice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hidden_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> choice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">124</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">batch_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> choice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">learning_rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> choice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0.0001</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0.001</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0.01</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">epochs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> choice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></div></div></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>See <a href="https://nni.readthedocs.io/en/stable/reference/experiment_config.html" target="_blank" rel="noopener noreferrer">NNI&#x27;s Experiment Config Reference</a> for more information and list of all available fields.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="executing-your-workflow"></a>Executing your Workflow<a aria-hidden="true" tabindex="-1" class="hash-link" href="#executing-your-workflow" title="Direct link to heading">#</a></h2><p>Now that you have set up your hyperparameter tuning Workflow Template and have a good understanding of the various configurations, you can execute the Workflow via Onepanel <a href="/docs/reference/workflows/execute">Web UI</a> or <a href="https://github.com/onepanelio/python-sdk/blob/master/examples/execute-workflow.ipynb" target="_blank" rel="noopener noreferrer">Python SDK</a>. </p><p>Once the Workflow is running, you can see your training progress in <strong>TensorBoard</strong> and <strong>NNI Web UI</strong> right from your Workflow Task by clicking on the <strong>hyperparameter-tuning</strong> Task, then clicking <strong>Outputs</strong>.</p><p><img src="/assets/images/hyperparamtuning-170923-15e15e092f85a322bb207f399dbb63e2.png"></p><p>Clicking <strong>Open NNI Web UI</strong> will display the following screen in a new tab:</p><p><img src="/assets/images/hyperparamtuning-171041-69354b04605af8ea2deea221f34ef1d1.png"></p><p>You can also view the corresponding TensorBoard by clicking <strong>Open TensorBoard</strong>:</p><p><img src="/assets/images/hyperparamtuning-171133-5f37f0276ee0ff9e7be663fbdaa7b195.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="persisting-best-metrics-model-and-hyperparameters"></a>Persisting best metrics, model and hyperparameters<a aria-hidden="true" tabindex="-1" class="hash-link" href="#persisting-best-metrics-model-and-hyperparameters" title="Direct link to heading">#</a></h2><p>Although optional, you should persist the best metrics to your Workflow and save the best model and parameters to your object storage.</p><p>Refer to the <a href="https://github.com/onepanelio/templates/tree/v0.18.0/workflows/hyperparameter-tuning/mnist/main.py" target="_blank" rel="noopener noreferrer">MNIST example code</a> for an example of how to do this.</p><p><img src="/assets/images/hyperparamtuning-173059-7bf96693d2d1f4f366b99907e0936819.png"></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/onepanelio/core-docs/tree/master/docs/reference/workflows/hyperparameter-tuning.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/reference/workflows/tensorboard"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Accessing TensorBoard</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/reference/workflows/troubleshooting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Troubleshooting Workflows Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setting-up-your-workflow-template" class="table-of-contents__link">Setting up your Workflow Template</a></li><li><a href="#understanding-the-configurations" class="table-of-contents__link">Understanding the configurations</a></li><li><a href="#executing-your-workflow" class="table-of-contents__link">Executing your Workflow</a></li><li><a href="#persisting-best-metrics-model-and-hyperparameters" class="table-of-contents__link">Persisting best metrics, model and hyperparameters</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 Onepanel, Inc.</div></div></div></footer></div>
<script src="/styles.7bfb6080.js"></script>
<script src="/runtime~main.84f271fb.js"></script>
<script src="/main.e056a727.js"></script>
<script src="/1.b53d8e00.js"></script>
<script src="/2.7abf20c6.js"></script>
<script src="/58.ffb2e96b.js"></script>
<script src="/61.9849afbd.js"></script>
<script src="/935f2afb.15dd73aa.js"></script>
<script src="/17896441.2bcb897b.js"></script>
<script src="/917b0442.c82b3e37.js"></script>
</body>
</html>