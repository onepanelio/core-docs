<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.62">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-106005416-5","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="The open and extensible IDE for computer vision" href="/opensearch.xml">
<script src="/js/gtm.js"></script><title data-react-helmet="true">Adding custom models and training Workflows in CVAT | The open and extensible IDE for computer vision</title><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Adding custom models and training Workflows in CVAT | The open and extensible IDE for computer vision"><meta data-react-helmet="true" name="description" content="Onepanel - Adding custom models and training Workflows in CVAT"><meta data-react-helmet="true" property="og:description" content="Onepanel - Adding custom models and training Workflows in CVAT"><meta data-react-helmet="true" property="og:url" content="https://docs.onepanel.ai/docs/reference/cvat/custom-models"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://docs.onepanel.ai/docs/reference/cvat/custom-models"><link rel="stylesheet" href="/styles.5bb0f708.css">
<link rel="preload" href="/styles.5e36217d.js" as="script">
<link rel="preload" href="/runtime~main.09489c9c.js" as="script">
<link rel="preload" href="/main.2d3ce5e5.js" as="script">
<link rel="preload" href="/1.c0cdb979.js" as="script">
<link rel="preload" href="/2.07d6c346.js" as="script">
<link rel="preload" href="/61.2a96af77.js" as="script">
<link rel="preload" href="/64.a72b10ba.js" as="script">
<link rel="preload" href="/935f2afb.2fa08a5f.js" as="script">
<link rel="preload" href="/17896441.e5999553.js" as="script">
<link rel="preload" href="/09d20bb8.c54c4738.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon.svg" alt="Onepanel logo"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/docs/getting-started/quickstart">Getting Started</a><a class="navbar__item navbar__link" href="/docs/reference/overview">User Guide</a><a class="navbar__item navbar__link" href="/docs/deployment/overview">Operator Manual</a><a href="https://github.com/onepanelio/core/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Releases</a><a href="https://github.com/onepanelio/core/milestones?direction=asc&amp;sort=due_date&amp;state=open" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Roadmap</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/onepanelio/onepanel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-github-link">GitHub</a><a href="https://join.slack.com/t/onepanel-ce/shared_invite/zt-eyjnwec0-nLaHhjif9Y~gA05KuX6AUg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-slack-link">Slack</a><a href="https://twitter.com/onepanelai" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-twitter-link">Twitter</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon.svg" alt="Onepanel logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/quickstart">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/reference/overview">User Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/deployment/overview">Operator Manual</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/core/releases" target="_blank" rel="noopener noreferrer" class="menu__link">Releases</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/core/milestones?direction=asc&amp;sort=due_date&amp;state=open" target="_blank" rel="noopener noreferrer" class="menu__link">Roadmap</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/onepanel" target="_blank" rel="noopener noreferrer" class="menu__link header-icon-link header-github-link">GitHub</a></li><li class="menu__list-item"><a href="https://join.slack.com/t/onepanel-ce/shared_invite/zt-eyjnwec0-nLaHhjif9Y~gA05KuX6AUg" target="_blank" rel="noopener noreferrer" class="menu__link header-icon-link header-slack-link">Slack</a></li><li class="menu__list-item"><a href="https://twitter.com/onepanelai" target="_blank" rel="noopener noreferrer" class="menu__link header-icon-link header-twitter-link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/reference/overview">User guide</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Workspaces</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/launching">Launching a Workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/pause-and-resume">Pause and resume</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/upgrade">Switching node pool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/delete">Terminating a Workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/templates">Workspace Templates</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Sidecars</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/sidecars/filesyncer">Filesyncer</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Workflows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/execute">Executing a Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/templates">Templates and parameters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/artifacts">Working with artifacts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/create">Creating a Workflow Template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/metrics">Persisting training metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/tensorboard">Accessing TensorBoard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/hyperparameter-tuning">Hyperparameter tuning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/troubleshooting">Troubleshooting Workflows</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Built-in and custom Workflows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/training">Model training</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/data-augmentation">Data augmentation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">CVAT Workspace</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cvat/quickstart">Getting started with image and video annotation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cvat/built-in-models">Training with built-in models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cvat/automatic-annotation">Using trained models for automatic annotation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/reference/cvat/custom-models">Adding custom training Workflows</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">JupyterLab Workspace</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/overview">JupyterLab overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/git">Using Git and browsing GitHub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/tensorboard">Using TensorBoard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/debugging">Using the built-in debugger</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/language-server">Auto completion and language features</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">SDKs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/sdks/python">Python SDK</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_1Lrw">Adding custom models and training Workflows in CVAT</h1></header><div class="markdown"><p>This guide will walk you through the process adding custom object detection or semantic segmentation training Workflow Templates in Onepanel that can be triggered from CVAT just like the <a href="/docs/reference/cvat/built-in-models">built-in model training Workflows</a></p><p>The steps to add your custom model training are as follows:</p><ol><li>Make sure your training code supports CVAT&#x27;s annotation formats.</li><li>Overview of the <strong>CVAT training Workflow Template</strong> that you&#x27;ll be using as base.</li><li>Update your training code&#x27;s input and output directory structures and push to a Git repository (e.g. GitHub).</li><li>Update <strong>CVAT training Workflow Template</strong> to reference your training code and install dependencies (if any).</li><li>Use your new Workflow Template to train models directly from CVAT.</li></ol><p>We will walk through these steps by adding the <a href="https://github.com/facebookresearch/detr" target="_blank" rel="noopener noreferrer">DEtection TRansformer (DETR)</a> model for semantic segmentation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="1-supported-annotation-formats"></a>1. Supported annotation formats<a aria-hidden="true" tabindex="-1" class="hash-link" href="#1-supported-annotation-formats" title="Direct link to heading">#</a></h2><p>When you click <strong>Execute training Workflow</strong> in CVAT, the annotation data dump is uploaded to your <a href="/docs/deployment/configuration/files#artifactrepository">default object storage</a> and then a Workflow Template (containing the relevant training code) is executed with reference to the location of the annotation data dump.</p><p>Now that you know how this feature works, the only requirement is that your training code needs to support the annotation formats that are supported by CVAT. For example, if your training code accepts data that follows COCO format (i.e JSON) then you need to indicate that in your newly created Workflow Template by updating the <code>dump_format</code> field (more on this field later in steps below).</p><p>The following annotation formats are supported by CVAT:</p><ul><li>MS COCO (<code>cvat_coco</code>)</li><li>YOLO (<code>cvat_yolo</code>)</li><li>TF Detection API (TFRecord) (<code>cvat_tfrecord</code>)</li><li>MOT (<code>cvat_mot</code>)</li><li>LabelMe (<code>cvat_label_me</code>)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="2-cvat-training-workflow-template-overview"></a>2. CVAT training Workflow Template Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#2-cvat-training-workflow-template-overview" title="Direct link to heading">#</a></h2><p>The <strong>CVAT training Workflow Template</strong> is the base template you can use to add any custom object detection or semantic segmentation model that will work directly with any CVAT Workspace. </p><p>This template is available in Onepanel by navigating to <strong>Workflows</strong> &gt; <strong>Workflow Templates</strong> &gt; <strong>Create Template</strong> and selecting <strong>CVAT Training</strong> under <strong>Templates</strong>.</p><p>Note that the <strong>CVAT Training</strong> Workflow Template has in-line comments describing the fields and what you would need to change. You will only need to change (or in some cases remove) the fields marked with <code>[CHANGE]</code>.</p><p>Some important notes about this template:</p><ol><li>The fields with the <code>cvat-</code> prefix are automatically populated by CVAT. The <code>dump_format</code> indicates to CVAT in which format to dump the annotations.</li><li>Your training code is cloned from your Git repository into <code>/mnt/src/train</code>.</li><li>The annotation dump is downloaded from object storage to <code>/mnt/data/datasets</code> and if any checkpoint models are selected, that is downloaded to <code>/mnt/data/models</code>.</li><li>Any output from your training code (model and <code>classes.csv</code> file) is expected to be written to <code>/mnt/output</code>. Files written to this location will be automatically uploaded to your default object storage and accessible to CVAT and other Workspaces.</li></ol><p>We will walk through updating the <a href="https://github.com/facebookresearch/detr" target="_blank" rel="noopener noreferrer">DEtection TRansformer (DETR)</a> code and this template in the following sections.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="3-update-the-training-code"></a>3. Update the training code<a aria-hidden="true" tabindex="-1" class="hash-link" href="#3-update-the-training-code" title="Direct link to heading">#</a></h2><p>In this step, you will launch a JupyterLab Workspace in Onepanel to test and adjust your code before it is added to the the CVAT training Workflow Template. The JupyterLab Workspace Template just like the CVAT training Workflow Template, uses the <code>onepanel/dl</code> Docker image which has both PyTorch 1.6 and TensorFlow 2.3 installed and provides a consistent environment for testing and deploying your training code.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Step 1 assumes you have created a task and annotated it in CVAT.</p></div></div><ol><li><p>From <strong>CVAT</strong>, pick a task and export data &amp; annotations by clicking<br>
<strong>Actions</strong> &gt; <strong>Export as dataset</strong> &gt; <strong>MS COCO</strong>.</p></li><li><p>Click <code>Copy directory path</code></p><img src="/img/cvat_export_complete.png" height="200"></li><li><p>Open up the Onepanel info tab by clicking the onepanel icon</p><img src="/img/icon-circle.png"></li><li><p>Paste the directory path into <code>Workspace path</code></p></li><li><p>Pick a path in <code>Object Storage Location</code></p></li><li><p>Click Sync to object storage</p><img src="/img/workspace_sync_files.png" height="300"></li><li><p>Fork the <a href="https://github.com/facebookresearch/detr" target="_blank" rel="noopener noreferrer">DEtection TRansformer (DETR)</a> repository.</p></li><li><p>Launch a <strong>JupyterLab</strong> Workspace on a GPU node pool, then <a href="/docs/reference/jupyterlab/git#cloning">clone</a> your fork. You can optionally run on a CPU node pool but it will take much longer to test.</p></li><li><p>In JupyterLab, open the <code>detr</code> directory and navigate to <code>datasets/coco.py</code>; then update the following lines:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-python codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">PATHS </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;train&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">root </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;train2017&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> root </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;annotations&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">mode</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">_train2017.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;val&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">root </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;val2017&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> root </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;annotations&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">f&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string-interpolation interpolation">mode</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-interpolation string" style="color:rgb(195, 232, 141)">_val2017.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>To the official COCO format structure:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-python codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">PATHS </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;train&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">root </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;images&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> root </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;annotations&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;instances_default.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;val&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">root </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;images&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> root </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;annotations&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;instances_default.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>For simplicity, the same data for train and validation sets. You can write a script or add another task that runs prior to this task in the CVAT training Workflow Template that splits this data accordingly. See our <a href="https://github.com/onepanelio/templates/tree/release-v0.18.0/workflows/albumentations-preprocessing" target="_blank" rel="noopener noreferrer">Albumentations Workflow Template</a> or the <a href="/docs/reference/workflows/training">built-in training Workflows</a> for reference on how to do this.</p></div></div></li><li><p>Sync your data dump from CVAT into JupyterLab by opening up the onepanel info tab, filling in the <code>Workspace path</code> and <code>Object Storage Location</code>, and clicking <code>Sync to Workspace</code></p><p>The <code>Workspace path</code> can be anything you like, such as <code>/data/temp</code> we&#x27;ll be moving it in a little bit.
The <code>Object storage location</code> should be the same as step 5 </p></li><li><p>Copy or move the data to <code>/mnt/data/datasets</code>. Note that the JupyterLab default directory is <code>/data</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> -p /mnt/data/datasets</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> -r /data/</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">path-to-dataset</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">/* /mnt/data/datasets</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The data and mnt directories are automatically mounted and created in CVAT training Workflow, so you do not have to do this when you add this code to the Workflow.</p></div></div></li><li><p>Install pre-requisites by going into the <code>/detr</code> directory and running:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pip </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -r requirements.txt</span></div></div></div></div></div></li><li><p>Run the following command to test your changes:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># if you are running on CPU, add  `--device cpu` flag</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">python main.py --coco_path /mnt/data/datasets --output_dir /mnt/output --epochs </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> --batch_size </span><span class="token number" style="color:rgb(247, 140, 108)">5</span></div></div></div></div></div><p>Take a note of these commands, you will be adding them to the CVAT training Workflow Template in later steps.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You can increase the batch size, but make sure it is less than the total number of data items you have, otherwise you will get a division by zero error.
If you get an error about memory, decrease the batch size.</p></div></div></li><li><p><a href="/docs/reference/jupyterlab/git#other-git-actions">Commit and push</a> your changes back to your repository.</p></li></ol><p>As mentioned before, the annotation data from CVAT is automatically dumped into <code>/mnt/data/datasets</code>. Since this code takes this path as an argument (<code>--coco_path</code>), you will pass the correct path in the Workflow Template later. Same applies to passing <code>/mnt/output</code> to  <code>--output_dir</code>. If your training code doesn&#x27;t have these parameters, we recommend you add them instead of hard coding these paths in your code.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="4-add-new-cvat-training-workflow-template"></a>4. Add new CVAT training Workflow Template<a aria-hidden="true" tabindex="-1" class="hash-link" href="#4-add-new-cvat-training-workflow-template" title="Direct link to heading">#</a></h2><p>Now that your code is update properly, you will need to add it in as a Workflow so that it can be used from CVAT (or even triggered from the <a href="https://github.com/onepanelio/python-sdk/blob/master/examples/execute-workflow.ipynb" target="_blank" rel="noopener noreferrer">Python SDK</a>) to train models on your data.</p><ol><li><p>Navigate to <strong>Workflows</strong> &gt; <strong>Workflow Templates</strong> &gt; <strong>Create Template</strong> and select <strong>CVAT Training</strong> under <strong>Templates</strong>.</p><p><img src="/assets/images/custom-models-120434-ec7a7d4867590792de92b023910947f5.png"></p></li><li><p>Give your template a name, in this case <strong>DETR object detection training</strong>.</p></li><li><p>In the next few steps, we&#x27;ll be following the in-line comments to update the template. Before continuing to the next step, it is good to review the <a href="/docs/reference/workflows/templates#parameters">parameters</a> documentation.</p></li><li><p>Change the <code>code</code> and <code>revision</code> parameters so that they point to your training code repository and branch.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] This is the path to your training code repository that will be cloned</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># For private repositories see: https://docs.onepanel.ai/docs/reference/workflows/artifacts#git</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> code</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/onepanelio/detr.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Model training code repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hidden</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] This is the name of branch or tag in your repository that will be used to clone your code</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> revision</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> master</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Model training code repository branch or tag name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hidden</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div></div></div></div></div></li><li><p>Remove the parameters that are not used by your training code. In this case, you can remove <code>cvat-num-classes</code> since the DETR training code can deduce this from the annotations. You can also remove <code>hyperparameters</code> since the DETR script takes these as individual arguments instead of having to parse a YAML.</p><p>Remove this block of YAML:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Number of classes</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># You can remove this if your code can deduce classes from annotation data</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">classes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Number of classes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Number of classes. In CVAT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this parameter will be pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">populated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;10&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Hyperparameters for your model</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Note that this will come in as multiline YAML that you will need to parse in your code</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># You can also remove this and create a separate parameter for each hyperparameter and pass them as an argument to your script</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hyperparameters</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Hyperparameters</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> textarea.textarea</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">num_steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#   Num steps per epoch</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> List of available hyperparameters</span></div></div></div></div></div></li><li><p>Add <code>epochs</code> and <code>batch-size</code> as parameters so we can pass them as arguments to our training code. You can add as many parameters as your training code needs.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> epochs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Number of epochs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;300&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> input.number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> batch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">size</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Batch size</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> input.number</span></div></div></div></div></div></li><li><p>Update <code>dump-format</code> parameter to a value that your training code expects from CVAT. In this case you can leave it as <code>cvat_coco</code> since we are expecting COCO JSON.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Dump format that your model expects from CVAT</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Valid values are: cvat_coco, cvat_voc, cvat_tfrecord, cvat_yolo, cvat_mot, cvat_label_me</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> dump</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">format</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat_coco</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> CVAT dump format</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div></div></div></div></div></li><li><p>Click <strong>Show Parameters Form Preview</strong> to preview how your parameters are displayed.</p><p><img src="/assets/images/custom-models-121715-54c18116a23a6b8f863c58e15b9d746b.png"></p></li><li><p>Following the in-line comments, update the <code>args</code> value under <code>containers</code> to match the commands we ran earlier in JupyterLab. Important differences to note here are that your repository is cloned into <code>/mnt/src/train</code> and that <code>epochs</code> and <code>batch-size</code> are passed into <code>main.py</code> as arguments by using parameter references in the format <code>&quot;{{workflow.parameters.&lt;parameter-name&gt;}}&quot;</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Bash command to run your code</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Note that your code will be cloned into /mnt/src/train, so you will need to change to the appropriate directory</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># if you are running on CPU, add  `--device cpu` flag</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        pip install pycocotools &amp;&amp; \</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        cd /mnt/src/train &amp;&amp; \</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        python -u main.py --coco_path /mnt/data/datasets \</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">            --output_dir /mnt/output \</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">            --epochs=&quot;{{workflow.parameters.epochs}}&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">            --batch_size=&quot;{{workflow.parameters.batch-size}}&quot;</span></div></div></div></div></div></li><li><p>(Optional) If your training code is not compatible TensorFlow 2.3 or PyTorch 1.6, you will need to update <code>image</code> to use a Docker image that is compatible with your training code.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Bash command to run your code</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Note that your code will be cloned into /mnt/src/train, so you will need to change to the appropriate directory</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># if you are running on CPU, add  `--device cpu` flag</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        pip install pycocotools &amp;&amp; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        cd /mnt/src/train &amp;&amp; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        python -u main.py --coco_path /mnt/data/datasets \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">            --output_dir /mnt/output \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">            --epochs=&quot;{{workflow.parameters.epochs}}&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">            --batch_size=&quot;{{workflow.parameters.batch-size}}&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># [CHANGE] Docker image to use to run your code</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># You can keep this as is if your code uses TensorFlow 2.3 or PyTorch 1.6</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># For private Docker repositories use imagePullSecrets: https://github.com/argoproj/argo/blob/master/examples/image-pull-secrets.yaml#L10-L11</span><span class="token plain"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> onepanel/dl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">v0.20.0</span></div></div></div></div></div></li><li><p>(Optional) If your training code has TensorBoard callbacks, make sure to write the TensorBoard logs to <code>/mnt/output</code> (we generally recommend writing to <code>/mnt/output/tensorboard</code> to better organize your output). You can then <a href="/docs/reference/workflows/tensorboard">access TensorBoard</a> when this training Workflow is running.</p></li><li><p>Click <strong>Save</strong> to create your new training Workflow Template.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="5-using-your-new-training-workflow-template-in-cvat"></a>5. Using your new training Workflow Template in CVAT<a aria-hidden="true" tabindex="-1" class="hash-link" href="#5-using-your-new-training-workflow-template-in-cvat" title="Direct link to heading">#</a></h2><p>Now you can use your new Workflow Template to train on your data directly from CVAT just like the <a href="/docs/reference/cvat/docs/reference/cvat/built-in-models">built-in training Workflow Templates</a>.</p><p><img src="/assets/images/custom-models-141235-408d83802c0084957e089b7671cb4248.png"></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/onepanelio/core-docs/tree/master/docs/reference/cvat/custom-models.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/reference/cvat/automatic-annotation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Using trained models for automatic annotation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/reference/jupyterlab/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">JupyterLab overview Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-supported-annotation-formats" class="table-of-contents__link">1. Supported annotation formats</a></li><li><a href="#2-cvat-training-workflow-template-overview" class="table-of-contents__link">2. CVAT training Workflow Template Overview</a></li><li><a href="#3-update-the-training-code" class="table-of-contents__link">3. Update the training code</a></li><li><a href="#4-add-new-cvat-training-workflow-template" class="table-of-contents__link">4. Add new CVAT training Workflow Template</a></li><li><a href="#5-using-your-new-training-workflow-template-in-cvat" class="table-of-contents__link">5. Using your new training Workflow Template in CVAT</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 Onepanel, Inc.</div></div></div></footer></div>
<script src="/styles.5e36217d.js"></script>
<script src="/runtime~main.09489c9c.js"></script>
<script src="/main.2d3ce5e5.js"></script>
<script src="/1.c0cdb979.js"></script>
<script src="/2.07d6c346.js"></script>
<script src="/61.2a96af77.js"></script>
<script src="/64.a72b10ba.js"></script>
<script src="/935f2afb.2fa08a5f.js"></script>
<script src="/17896441.e5999553.js"></script>
<script src="/09d20bb8.c54c4738.js"></script>
</body>
</html>