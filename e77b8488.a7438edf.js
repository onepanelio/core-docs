(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{117:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return i})),t.d(a,"metadata",(function(){return l})),t.d(a,"rightToc",(function(){return s})),t.d(a,"default",(function(){return p}));var n=t(2),o=(t(0),t(127)),r=t(134),c=t(135);const i={title:"MicroK8s on remote machines",sidebar_label:"MicroK8s on remote machines",description:"Onepanel - Setting up MicroK8s on a remote machines"},l={unversionedId:"deployment/configuration/remote-microk8s",id:"deployment/configuration/remote-microk8s",isDocsHomePage:!1,title:"MicroK8s on remote machines",description:"Onepanel - Setting up MicroK8s on a remote machines",source:"@site/docs/deployment/configuration/remote-microk8s.md",slug:"/deployment/configuration/remote-microk8s",permalink:"/docs/deployment/configuration/remote-microk8s",editUrl:"https://github.com/onepanelio/core-docs/tree/master/docs/deployment/configuration/remote-microk8s.md",version:"current",sidebar_label:"MicroK8s on remote machines",sidebar:"deployment",previous:{title:"Local DNS with Dnsmasq",permalink:"/docs/deployment/configuration/dns"},next:{title:"Microk8s + Local Minio",permalink:"/docs/deployment/configuration/miniotenants"}},s=[{value:"Microk8s installation and setup",id:"microk8s-installation-and-setup",children:[]},{value:"(Optional) Mount external disks",id:"optional-mount-external-disks",children:[]},{value:"Install Onepanel",id:"install-onepanel",children:[]},{value:"Expose Onepanel using Nginx",id:"expose-onepanel-using-nginx",children:[]},{value:"Configure Local DNS",id:"configure-local-dns",children:[]},{value:"Use Onepanel",id:"use-onepanel",children:[]},{value:"GPU Setup",id:"gpu-setup",children:[]}],b={rightToc:s};function p({components:e,...a}){return Object(o.b)("wrapper",Object(n.a)({},b,a,{components:e,mdxType:"MDXLayout"}),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"We are only providing this guide as a reference. Due to the complexity of different installations, we can only provide open source support for clusters running Ubuntu 20.04 or higher as host OS on a local cluster."),Object(o.b)("p",{parentName:"div"},"Please visit our ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.onepanel.ai/"}),"Website")," and contact us for other bare metal installation options."))),Object(o.b)("p",null,"You can set up and access Onepanel on a remote computer that you can access via SSH."),Object(o.b)("p",null,"This can be a VM in the cloud, or Multipass running locally. In either case, it has to be running Ubuntu 20.04 or higher."),Object(o.b)("h2",{id:"microk8s-installation-and-setup"},"Microk8s installation and setup"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Set up your VM"),Object(o.b)(r.a,{groupId:"provider",defaultValue:"cloud_vm",values:[{label:"Cloud VM",value:"cloud_vm"},{label:"Multipass",value:"multipass"}],mdxType:"Tabs"},Object(o.b)(c.a,{value:"cloud_vm",mdxType:"TabItem"},Object(o.b)("p",{parentName:"li"},"Set up your VM according to your cloud provider instructions."),Object(o.b)("div",Object(n.a)({parentName:"li"},{className:"admonition admonition-important alert alert--info"}),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Onepanel requires at least 40GB of hard disk space. If your VM doesn't have that much you'll\nhave to mount an external disk. In that case, make sure to do step 5.")))),Object(o.b)(c.a,{value:"multipass",mdxType:"TabItem"},Object(o.b)("p",{parentName:"li"},"Install ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://multipass.run/"}),"Multipass"),", then launch a VM"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"multipass launch --cpus 2 --mem 12G --disk 40G --name sample\n"))))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Install MicroK8s"),Object(o.b)("div",Object(n.a)({parentName:"li"},{className:"admonition admonition-note alert alert--secondary"}),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"All further instructions are in your remote computer/vm unless otherwise indicated."))),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo snap install microk8s --channel=1.19/stable --classic\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Update your permissions"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo usermod -a -G microk8s $USER\nsudo chown -f -R $USER ~./kube\n")),Object(o.b)("p",{parentName:"li"},"Log out and in for changes to take effect"),Object(o.b)("p",{parentName:"li"},"Wait for microk8s to be ready"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s status --wait-ready\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Update API server config"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo nano /var/snap/microk8s/current/args/kube-apiserver\n")),Object(o.b)("p",{parentName:"li"},"Add to the top"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"--service-account-signing-key-file=${SNAP_DATA}/certs/serviceaccount.key\n--service-account-key-file=${SNAP_DATA}/certs/serviceaccount.key\n--service-account-issuer=api\n--service-account-api-audiences=api,nats\n")),Object(o.b)("p",{parentName:"li"},"Restart microk8s for the changes to take effect"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s stop && microk8s start && microk8s status --wait-ready\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Enable microk8s addons"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo microk8s enable storage dns rbac\nmicrok8s status --wait-ready\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Configure DNS"),Object(o.b)(r.a,{groupId:"provider",defaultValue:"cloud_vm",values:[{label:"Cloud VM",value:"cloud_vm"},{label:"Multipass",value:"multipass"}],mdxType:"Tabs"},Object(o.b)(c.a,{value:"cloud_vm",mdxType:"TabItem"},Object(o.b)("p",{parentName:"li"},"i. Edit the resolvconf"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo nano /var/snap/microk8s/current/args/kubelet\n")),Object(o.b)("p",{parentName:"li"},"Add to the top"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"--resolv-conf=/run/systemd/resolve/resolv.conf\n")),Object(o.b)("p",{parentName:"li"},"ii. Edit coredns configmap so we point to the resolv.conf file"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s kubectl edit cm coredns -n kube-system\n")),Object(o.b)("p",{parentName:"li"},"Set the forward section to:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"forward . /etc/resolv.conf 8.8.8.8  8.8.4.4\n")),Object(o.b)("p",{parentName:"li"},"iii. Restart microk8s"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s stop && microk8s start && microk8s status --wait-ready\n"))),Object(o.b)(c.a,{value:"multipass",mdxType:"TabItem"},"No configuration is required for multipass.")))),Object(o.b)("h2",{id:"optional-mount-external-disks"},"(Optional) Mount external disks"),Object(o.b)("p",null,"  If you are using a VM in the cloud, you need at least 40GB of hard disk space.\nMount your disk if you haven't already. We'll assume your disk is mounted at ",Object(o.b)("inlineCode",{parentName:"p"},"/data")),Object(o.b)("p",null,"  We need to tell microk8s to use the mounted disk so we have more storage space."),Object(o.b)("p",null,"  Create the following directories"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo mkdir -p /data/var/lib/containerd\nsudo mkdir -p /data/run/containerd\n")),Object(o.b)("p",null,"  Edit the containerd arguments"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo nano /var/snap/microk8s/current/args/containerd\n")),Object(o.b)("p",null,"  Change the contents to"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"--config ${SNAP_DATA}/args/containerd.toml\n--root /data/var/lib/containerd\n--state /data/run/containerd\n--address ${SNAP_COMMON}/run/containerd.sock\n")),Object(o.b)("p",null,"  Then, restart microk8s"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s stop && microk8s start && microk8s status --wait-ready\n")),Object(o.b)("h2",{id:"install-onepanel"},"Install Onepanel"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Install"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"curl -sLO https://github.com/onepanelio/onepanel/releases/download/v0.21.0/opctl-linux-amd64\nchmod +x opctl-linux-amd64\nsudo mv ./opctl-linux-amd64 /usr/local/bin/opctl\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Initialize Onepanel"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"opctl init --provider microk8s \\\n--enable-metallb \\\n--artifact-repository-provider abs\n")),Object(o.b)("div",Object(n.a)({parentName:"li"},{className:"admonition admonition-note alert alert--secondary"}),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"I used Azure Block Storage (abs) as the artifact-repository-provider above, but you can use s3, abs, or gcs")))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Populate ",Object(o.b)("inlineCode",{parentName:"p"},"params.yaml")," by following the instructions in the template, and referring to ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/deployment/configuration/files#sections"}),"configuration file sections")," for more detailed information."),Object(o.b)("p",{parentName:"li"},"Here's a mostly filled out ",Object(o.b)("inlineCode",{parentName:"p"},"params.yaml")," for a quickstart. You'll need to fill out ",Object(o.b)("inlineCode",{parentName:"p"},"artifactRepository")),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"application:\n  defaultNamespace: example\n  domain: onepanel.test\n  fqdn: app.onepanel.test\n  insecure: true\n  nodePool:\n    label: node.kubernetes.io/instance-type\n    options:\n      - name: 'Local machine'\n        value: 'local'\n  provider: microk8s\n# You need to fill this part out according to your artifact repository provider\nartifactRepository:\n  # FILL ME OUT\ncertManager:\n  email: test@test.com # Not used in local deployments as certs are generated locally\nmetalLb:\n  addresses:\n    - 192.168.99.0/32\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Deploy onepanel"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s config > kubeconfig\nKUBECONFIG=./kubeconfig opctl apply\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Label your nodes"),Object(o.b)("p",{parentName:"li"},"To allow Workspaces to run on your machine(s) you need to label them."),Object(o.b)("p",{parentName:"li"},"First, get the names of your nodes by running:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s kubectl get nodes\n")),Object(o.b)("p",{parentName:"li"},"You will get results similar to below:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"NAME     STATUS   ROLES    AGE   VERSION\nsample   Ready    <none>   11m   v1.19.8-34+811e9feeade1d3\n")),Object(o.b)("p",{parentName:"li"},"Then, for each node name, add the label from your ",Object(o.b)("inlineCode",{parentName:"p"},"application.nodePool.label")," from your ",Object(o.b)("inlineCode",{parentName:"p"},"params.yaml"),", above we used,"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"nodePool:\n    label: node.kubernetes.io/instance-type\n    options:\n      - name: 'Local machine'\n        value: local\n")),Object(o.b)("p",{parentName:"li"},"and the node above is called ",Object(o.b)("inlineCode",{parentName:"p"},"sample"),", you can label the node as follows:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s kubectl label node sample node.kubernetes.io/instance-type=local\n")))),Object(o.b)("h2",{id:"expose-onepanel-using-nginx"},"Expose Onepanel using Nginx"),Object(o.b)("p",null,"  Since Onepanel is running inside a VM, we need to expose it so we can access it on our local computers.\nTo do so, we use nginx."),Object(o.b)("p",null,"  First, install nginx."),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo apt-get install nginx\n")),Object(o.b)("p",null,"  Then, configure nginx to expose Onepanel"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo nano /etc/nginx/sites-available/default \n")),Object(o.b)("p",null,"  Change this"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"location / {\n        # First attempt to serve request as file, then\n        # as directory, then fall back to displaying a 404.\n        try_files $uri $uri/ =404;\n}\n")),Object(o.b)("p",null,"  to"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),'location / {\n  client_max_body_size 0; # No size limit to upload requests    \n  proxy_pass http://192.168.99.0; # the ip address you gave metallb\n  proxy_set_header Host $host;\n  proxy_http_version 1.1;\n  proxy_set_header Upgrade $http_upgrade;\n  proxy_set_header Connection "upgrade";\n  proxy_request_buffering off;\n}\n')),Object(o.b)("p",null,"  Then, stop editing and run"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo nginx -s reload\n")),Object(o.b)("h2",{id:"configure-local-dns"},"Configure Local DNS"),Object(o.b)("p",null,"  On your local machine, we need to point DNS so it knows about Onepanel."),Object(o.b)("p",null,"  Below we edit the hosts file, but you can use DNSMasq for a more robust set up."),Object(o.b)("p",null,"  Get the IP address of your VM. For VMs in the cloud, this is given to you.\nIn multipass you can see it with ",Object(o.b)("inlineCode",{parentName:"p"},"multipass list")),Object(o.b)("p",null,"  For this example, we'll assume the IP is: ",Object(o.b)("inlineCode",{parentName:"p"},"15.92.2.237")),Object(o.b)("p",null,"  Then, edit your hosts file using a text editor. The location depends on your operation system."),Object(o.b)(r.a,{groupId:"os",defaultValue:"linux",values:[{label:"Linux",value:"linux"},{label:"Mac",value:"mac"},{label:"Windows",value:"windows"}],mdxType:"Tabs"},Object(o.b)(c.a,{value:"linux",mdxType:"TabItem"},Object(o.b)("p",null,"  ",Object(o.b)("inlineCode",{parentName:"p"},"/etc/hosts"))),Object(o.b)(c.a,{value:"mac",mdxType:"TabItem"},Object(o.b)("p",null,"  ",Object(o.b)("inlineCode",{parentName:"p"},"/etc/hosts"))),Object(o.b)(c.a,{value:"windows",mdxType:"TabItem"},Object(o.b)("p",null,"  ",Object(o.b)("inlineCode",{parentName:"p"},"C:\\Windows\\System32\\drivers\\etc\\hosts")))),Object(o.b)("p",null,"  and add to the top"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"# <ip> <fqdn>\n15.92.2.237 app.onepanel.test\n")),Object(o.b)("h2",{id:"use-onepanel"},"Use Onepanel"),Object(o.b)("p",null,"  In your VM, Get your authentication login with"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s config > kubeconfig\nKUBECONFIG=./kubeconfig opctl auth token\n")),Object(o.b)("p",null,"  Open up ",Object(o.b)("inlineCode",{parentName:"p"},"app.onepanel.test")," in your browser, paste in the credentials, and you are good to go!"),Object(o.b)("h2",{id:"gpu-setup"},"GPU Setup"),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"For instances running with GPUs we recommend having a disk size of at least 100GB.",Object(o.b)("br",{parentName:"p"}),"\n","All further instructions are in your remote computer/vm unless otherwise indicated."))),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Verify you have a CUDA capable GPU."),Object(o.b)("p",{parentName:"li"},"From the command line, enter"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"lspci | grep -i nvidia\n")),Object(o.b)("p",{parentName:"li"},"sample output"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"0001:00:00.0 3D controller: NVIDIA Corporation GK210GL [Tesla K80] (rev a1)\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Verify the system has the correct kernel headers and development packages installed"),Object(o.b)("p",{parentName:"li"},"The CUDA Driver requires that the kernel headers and development packages for the running version of the kernel be installed at the time of the driver installation, as well whenever the driver is rebuilt."),Object(o.b)("p",{parentName:"li"},"The version of the kernel your system is running can be found by running the following command:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"uname -r\n")),Object(o.b)("p",{parentName:"li"},"The kernel headers and development packages for the currently running kernel can be installed with:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo apt-get install linux-headers-$(uname -r)\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Install NVIDIA CUDA "),Object(o.b)("p",{parentName:"li"},"You can download it at ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://developer.nvidia.com/cuda-downloads"}),"https://developer.nvidia.com/cuda-downloads")),Object(o.b)("p",{parentName:"li"},"Or run the commands below"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin\nsudo mv cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600\nwget https://developer.download.nvidia.com/compute/cuda/11.3.1/local_installers/cuda-repo-ubuntu2004-11-3-local_11.3.1-465.19.01-1_amd64.deb\nsudo dpkg -i cuda-repo-ubuntu2004-11-3-local_11.3.1-465.19.01-1_amd64.deb\nsudo apt-key add /var/cuda-repo-ubuntu2004-11-3-local/7fa2af80.pub\nsudo apt-get update\nsudo apt-get -y install cuda\n")),Object(o.b)("p",{parentName:"li"},"You'll need to restart your machine after installation.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Verify installation with:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"nvidia-smi\n")),Object(o.b)("p",{parentName:"li"},"sample output:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 465.19.01    Driver Version: 465.19.01    CUDA Version: 11.3     |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|                               |                      |               MIG M. |\n|===============================+======================+======================|\n|   0  NVIDIA Tesla K80    On   | 00000001:00:00.0 Off |                    0 |\n| N/A   41C    P8    25W / 149W |      0MiB / 11441MiB |      0%      Default |\n|                               |                      |                  N/A |\n+-------------------------------+----------------------+----------------------+\n\n+-----------------------------------------------------------------------------+\n| Processes:                                                                  |\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n|        ID   ID                                                   Usage      |\n|=============================================================================|\n|  No running processes found                                                 |\n+-----------------------------------------------------------------------------+\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Enable NVIDIA GPU support for MicroK8s."),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s enable gpu\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"In your ",Object(o.b)("inlineCode",{parentName:"p"},"params.yaml")," make sure to update the ",Object(o.b)("inlineCode",{parentName:"p"},"nodePool:")," section"),Object(o.b)("p",{parentName:"li"},"It should look something like this:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),'nodePool:\n    # Cloud providers will automatically set label key as "node.kubernetes.io/instance-type" on all nodes\n    # For Kubernetes 1.16.x, use "beta.kubernetes.io/instance-type"\n    label: node.kubernetes.io/instance-type\n    # These are the machine type options that will be available in Onepanel\n    #   `name` can be any user friendly name\n    #   `value` should be the instance type in your cloud provider\n    #   `resources.limits` should only be set if the node pool has GPUs\n    # The first option will be used as default.\n    options:\n      - name: \'Local GPU\'\n        value: gpu\n        resources:\n          limits:\n            nvidia.com/gpu: 1\nprovider: microk8s\n')),Object(o.b)("p",{parentName:"li"},"and then overwrite the label for your gpu nodes."),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s kubectl label node sample node.kubernetes.io/instance-type=gpu --overwrite\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Make sure to apply changes to use GPU nodes in your deployment:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"microk8s config > kubeconfig\nKUBECONFIG=./kubeconfig opctl apply\n")))))}p.isMDXComponent=!0},127:function(e,a,t){"use strict";t.d(a,"a",(function(){return p})),t.d(a,"b",(function(){return d}));var n=t(0),o=t.n(n);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function c(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?c(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=o.a.createContext({}),b=function(e){var a=o.a.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},p=function(e){var a=b(e.components);return o.a.createElement(s.Provider,{value:a},e.children)},m={inlineCode:"code",wrapper:function(e){var a=e.children;return o.a.createElement(o.a.Fragment,{},a)}},u=o.a.forwardRef((function(e,a){var t=e.components,n=e.mdxType,r=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=b(t),u=n,d=p["".concat(c,".").concat(u)]||p[u]||m[u]||r;return t?o.a.createElement(d,i(i({ref:a},s),{},{components:t})):o.a.createElement(d,i({ref:a},s))}));function d(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var r=t.length,c=new Array(r);c[0]=u;var i={};for(var l in a)hasOwnProperty.call(a,l)&&(i[l]=a[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,c[1]=i;for(var s=2;s<r;s++)c[s]=t[s];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},129:function(e,a,t){"use strict";function n(e){var a,t,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(a=0;a<e.length;a++)e[a]&&(t=n(e[a]))&&(o&&(o+=" "),o+=t);else for(a in e)e[a]&&(o&&(o+=" "),o+=a);return o}a.a=function(){for(var e,a,t=0,o="";t<arguments.length;)(e=arguments[t++])&&(a=n(e))&&(o&&(o+=" "),o+=a);return o}},130:function(e,a,t){"use strict";var n=t(0);const o=Object(n.createContext)(void 0);a.a=o},131:function(e,a,t){"use strict";var n=t(0),o=t(130);a.a=function(){const e=Object(n.useContext)(o.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},134:function(e,a,t){"use strict";var n=t(0),o=t.n(n),r=t(131),c=t(129),i=t(48),l=t.n(i);const s=37,b=39;a.a=function(e){const{block:a,children:t,defaultValue:i,values:p,groupId:m}=e,{tabGroupChoices:u,setTabGroupChoices:d}=Object(r.a)(),[O,j]=Object(n.useState)(i),[N,h]=Object(n.useState)(!1);if(null!=m){const e=u[m];null!=e&&e!==O&&p.some(a=>a.value===e)&&j(e)}const g=e=>{j(e),null!=m&&d(m,e)},v=[],f=e=>{e.metaKey||e.altKey||e.ctrlKey||h(!0)},y=()=>{h(!1)};return Object(n.useEffect)(()=>{window.addEventListener("keydown",f),window.addEventListener("mousedown",y)},[]),o.a.createElement("div",null,o.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(c.a)("tabs",{"tabs--block":a})},p.map(({value:e,label:a})=>o.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":O===e,className:Object(c.a)("tabs__item",l.a.tabItem,{"tabs__item--active":O===e}),style:N?{}:{outline:"none"},key:e,ref:e=>v.push(e),onKeyDown:e=>{((e,a,t)=>{switch(t.keyCode){case b:((e,a)=>{const t=e.indexOf(a)+1;e[t]?e[t].focus():e[0].focus()})(e,a);break;case s:((e,a)=>{const t=e.indexOf(a)-1;e[t]?e[t].focus():e[e.length-1].focus()})(e,a)}})(v,e.target,e),f(e)},onFocus:()=>g(e),onClick:()=>{g(e),h(!1)},onPointerDown:()=>h(!1)},a))),o.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},n.Children.toArray(t).filter(e=>e.props.value===O)[0]))}},135:function(e,a,t){"use strict";var n=t(0),o=t.n(n);a.a=function(e){return o.a.createElement("div",null,e.children)}}}]);